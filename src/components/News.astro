---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import { DateTime } from "luxon";

interface Props {
  singleNews: CollectionEntry<"noticias">;
}

const { singleNews } = Astro.props;
const { image, title, description, pubDate, author, tags } = singleNews.data;

const dt = DateTime.fromJSDate(pubDate, { zone: "America/Sao_Paulo" });

const formattedDate = dt.toFormat("dd MMM yyyy"); // ex: 28 jun. 2025
const formattedTime = dt.toFormat("HH:mm"); // ex: 10:30

const formattedMonthShort = dt
  .toLocaleString({ month: "short" })
  .replace(/\./g, "");
const finalFormattedDate = `${dt.day} ${formattedMonthShort} ${dt.year}`;
---

<article class="news-item">
  <a href={`/noticias/${singleNews.id}/`} class="news-item__link">
    <div class="news-item__image-wrapper">
      <figure class="news-item__figure">
        <Image
          src={image.src}
          alt={image.alt}
          widths={[300, 450, 600]}
          sizes="(max-width: 600px) 100vw, 300px"
          loading="lazy"
          decoding="async"
          class="news-item__image"
        />
        <figcaption class="news-item__caption">{image.caption}</figcaption>
      </figure>
    </div>

    <div class="news-item__content">
      <header class="news-item__header">
        <p class="news-item__category">{tags && tags[0]}</p>
        <h2 class="news-item__title">{title}</h2>
        <p class="news-item__meta">
          <span>Por {author}</span> —
          <time class="news-item__meta-date" datetime={pubDate.toISOString()}>
            {finalFormattedDate}
            {formattedTime} BRT
          </time>
        </p>
      </header>

      <p class="news-item__excerpt">{description}</p>
    </div>
  </a>
</article>

<style>
  :root {
    --color-el-pais-text: #333;
    --color-el-pais-light-text: #666;
    --color-el-pais-border: #eee;
    --color-el-pais-highlight: #007bff; /* Para categorias e links, se desejar */

    --font-el-pais-heading: "Merriweather", serif;
    --font-el-pais-body: "Open Sans", sans-serif;
  }

  .news-item {
    display: flex;
    border-bottom: 1px solid var(--color-el-pais-border); /* Linha divisória horizontal */
    padding: 20px 0; /* Espaçamento vertical entre os itens */
    margin: 0 20px; /* Margem lateral para não colar nas bordas da tela */
    background-color: #fff; /* Fundo branco para o item */
    transition: background-color 0.2s ease;
  }

  .news-item:first-child {
    border-top: 1px solid var(--color-el-pais-border); /* Linha divisória no topo do primeiro item */
  }

  .news-item:hover {
    background-color: #f9f9f9; /* Leve alteração de cor ao passar o mouse */
  }

  .news-item__link {
    display: flex; /* Habilita flexbox para alinhar imagem e texto */
    text-decoration: none;
    color: var(--color-el-pais-text);
    width: 100%; /* O link ocupa toda a largura do news-item */
  }

  .news-item__image-wrapper {
    flex-shrink: 0; /* Impede que a imagem encolha */
    width: 200px; /* Largura fixa da imagem, ajuste conforme a imagem do El País */
    height: 120px; /* Altura fixa da imagem */
    margin-right: 20px; /* Espaço entre a imagem e o texto */
    position: relative;
    overflow: hidden; /* Para lidar com border-radius ou qualquer overflow */
  }

  .news-item__figure {
    margin: 0; /* Remove margem padrão de figure */
    width: 100%;
    height: 100%;
    display: flex;
  }

  .news-item__image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Recorta a imagem para preencher o espaço */
    display: block; /* Remove espaço extra abaixo da imagem */
  }

  .news-item__caption {
    /* O El País geralmente não mostra legendas de imagens em miniaturas, então podemos ocultá-las ou estilizá-las de forma muito sutil */
    display: none; /* Oculta a legenda na miniatura */
  }

  .news-item__content {
    flex-grow: 1; /* Faz o conteúdo textual ocupar o espaço restante */
    display: flex;
    flex-direction: column;
    justify-content: center; /* Centraliza verticalmente se o conteúdo for curto */
  }

  .news-item__header {
    margin-bottom: 5px; /* Espaçamento entre cabeçalho e resumo */
  }

  .news-item__category {
    font-family: var(--font-el-pais-body);
    font-size: 0.85em;
    font-weight: 600; /* Mais bold para destaque */
    color: var(--color-el-pais-light-text); /* Cor mais clara para categoria */
    text-transform: uppercase; /* Maiúsculas, como no El País */
    margin: 0 0 5px 0; /* Espaçamento inferior */
  }

  .news-item__title {
    font-family: var(--font-el-pais-heading);
    font-size: 1.25rem; /* Título mais pronunciado */
    line-height: 1.3;
    color: var(--color-el-pais-text);
    margin: 0 0 8px 0; /* Espaçamento inferior */
  }

  .news-item__title:hover {
    text-decoration: underline; /* Sublinhado ao passar o mouse, como links de texto */
    text-decoration-color: var(--color-el-pais-text); /* Cor do sublinhado */
  }

  .news-item__meta {
    font-family: var(--font-el-pais-body);
    font-size: 0.75em; /* Texto meta bem pequeno */
    color: var(--color-el-pais-light-text);
    margin: 0;
    display: flex;
    align-items: center;
    flex-wrap: wrap; /* Para evitar quebrar em telas muito pequenas */
  }

  .news-item__meta-source,
  .news-item__meta-location {
    font-weight: 600; /* Fonte mais bold para fonte e localização */
  }

  .news-item__meta-separator {
    margin: 0 5px; /* Espaçamento para o separador | */
  }

  .news-item__meta-date {
    /* Estilos específicos para a data, se houver */
  }

  .news-item__excerpt {
    font-family: var(--font-el-pais-body);
    font-size: 0.95em; /* Tamanho do resumo */
    line-height: 1.5;
    color: var(--color-el-pais-text);
    margin-bottom: 0; /* Remove margem inferior padrão */
  }

  /* O footer com data e autor geralmente não aparece neste tipo de layout de lista no El País,
     mas se precisar, você pode estilizá-lo discretamente */
  .news-item__footer {
    display: none; /* Oculta o footer para replicar o estilo do El País */
    /* Se você quiser mantê-lo, remova o 'display: none;' e estilize-o discretamente: */
    /*
    font-size: 0.7em;
    color: var(--color-el-pais-light-text);
    margin-top: 10px;
    */
  }

  /* --- Responsividade (Media Queries) --- */

  @media (max-width: 768px) {
    .news-item__link {
      flex-direction: column; /* Em telas menores, a imagem vai para cima */
    }

    .news-item__image-wrapper {
      width: 100%; /* Imagem ocupa a largura total */
      height: 180px; /* Ajuste a altura para mobile */
      margin-right: 0;
      margin-bottom: 15px; /* Espaçamento abaixo da imagem */
    }

    .news-item__content {
      padding: 0; /* Sem padding extra no conteúdo para mobile */
    }

    .news-item__title {
      font-size: 1.15rem; /* Reduz o tamanho do título em mobile */
    }

    .news-item__excerpt {
      font-size: 0.9em; /* Reduz o tamanho do resumo em mobile */
    }

    .news-item {
      padding: 15px 0; /* Reduz o padding vertical */
      margin: 0 15px; /* Reduz a margem lateral */
    }
  }

  @media (max-width: 480px) {
    .news-item__meta {
      flex-direction: column; /* Quebra as infos meta em várias linhas */
      align-items: flex-start;
    }
    .news-item__meta-separator {
      display: none; /* Oculta os separadores */
    }
  }
</style>
